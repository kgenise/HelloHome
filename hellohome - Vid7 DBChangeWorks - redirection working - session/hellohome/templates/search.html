{% extends "layout.html" %}

{% block content %}


<!-- START FILTER -->
<div>

    <!-- action empty string : go to same route/post info at same route after posting -->
    <form method="POST" action="">
        {{ form.hidden_tag() }}
		

			<!-- each field list of errors if field invalid -->
			<!-- open up conditional & print out errors -->
			<!-- Bootstrap: (1) add class of isInvalid to field (2) div underneath w/h class of invalid feedback (3) inside error -->

        	<!-- form-group bootstrap class -->
	
			<div class="row">	
				<!-- for groups -->
	
				<!-- 1. Searchbar -->
				<div class="form-group">
					{{ form.searchbar.label(class="form-control-label") }}
					{% if form.searchbar.errors %}
						{{ form.searchbar(class="form-control form-control-lg is-invalid") }}
						<div class="invalid-feedback">
							{% for error in form.searchbar.errors %}
								<span>{{ error }}</span>
							{% endfor %}
						</div>
					{% else %}
						<!-- Show valid field -->
						{{ form.searchbar(class="form-control form-control-lg filter_searchbar") }}
					{% endif %}
				</div>
				<!-- 2. For Type -->
				<div class="form-group">
					{{ form.fortype.label(class="form-control-label") }}
					{% if form.fortype.errors %}
						{{ form.fortype(class="form-control form-control-lg is-invalid") }}
						<div class="invalid-feedback">
							{% for error in form.fortype.errors %}
								<span>{{ error }}</span>
							{% endfor %}
						</div>
					{% else %}
						<!-- Show valid field -->
						{{ form.fortype(class="form-control form-control-lg") }}
					{% endif %}
				</div>
				<!-- 3. MIN Price -->
				<div class="form-group">
					{{ form.minprice.label(class="form-control-label") }}
					{% if form.minprice.errors %}
						{{ form.minprice(class="form-control form-control-lg is-invalid") }}
						<div class="invalid-feedback">
							{% for error in form.minprice.errors %}
								<span>{{ error }}</span>
							{% endfor %}
						</div>
					{% else %}
						<!-- Show valid field -->
						{{ form.minprice(class="form-control form-control-lg minn") }}
					{% endif %}
				</div>
				<!-- 3. MAX Price -->
				<div class="form-group">
					{{ form.maxprice.label(class="form-control-label") }}
					{% if form.maxprice.errors %}
						{{ form.maxprice(class="form-control form-control-lg is-invalid") }}
						<div class="invalid-feedback">
							{% for error in form.maxprice.errors %}
								<span>{{ error }}</span>
							{% endfor %}
						</div>
					{% else %}
						<!-- Show valid field -->
						{{ form.maxprice(class="form-control form-control-lg maxx") }}
					{% endif %}
				</div>

				<!-- start JS -->
				<script>
					const minn = document.querySelector('.minn');
					minn.selected
					const maxx = document.querySelector('.maxx');

					minn.addEventListener('change', (event) => {
						//if someone clicks on min dropdown again, bring max VALUE back to "No Max" 
						maxx.options[0].selected = true;

						for(i=0; i<maxx.options.length;i++){
							//if maxx has any value that is less than the minimum, disable it
							if ( parseInt(maxx.options[i].value) < parseInt(minn.value) ) {
								maxx.options[i].disabled = true;
								//alert("Hello! I am an alert box!!");
							}								
							else {
								maxx.options[i].disabled = false;
							}
								
						}
					});

					maxx.addEventListener('change', (event) => {
					//if someone clicks on min dropdown again, bring max VALUE back to "No Max" 
						if ( parseInt(maxx.value) < parseInt(minn.value) ) {
							minn.options[0].selected = true;
						}
					});
				</script>
				<!-- end JS -->

		
				<!-- 4. Property Type -->
				<div class="form-group">
					{{ form.propertytype.label(class="form-control-label") }}
					{% if form.propertytype.errors %}
						{{ form.propertytype(class="form-control form-control-lg is-invalid") }}
						<div class="invalid-feedback">
							{% for error in form.propertytype.errors %}
								<span>{{ error }}</span>
							{% endfor %}
						</div>
					{% else %}
						<!-- Show valid field -->
						{{ form.propertytype(class="form-control form-control-lg") }}
					{% endif %}
				</div>
				<!-- 5. Number of Beds -->
				<div class="form-group">
					{{ form.num_bed.label(class="form-control-label") }}
					{% if form.num_bed.errors %}
						{{ form.num_bed(class="form-control form-control-lg is-invalid") }}
						<div class="invalid-feedback">
							{% for error in form.num_bed.errors %}
								<span>{{ error }}</span>
							{% endfor %}
						</div>
					{% else %}
						<!-- Show valid field -->
						{{ form.num_bed(class="form-control form-control-lg") }}
					{% endif %}
				</div>
				<!-- 6. Number of Baths -->
				<div class="form-group">
					{{ form.num_bath.label(class="form-control-label") }}
					{% if form.num_bath.errors %}
						{{ form.num_bath(class="form-control form-control-lg is-invalid") }}
						<div class="invalid-feedback">
							{% for error in form.num_bath.errors %}
								<span>{{ error }}</span>
							{% endfor %}
						</div>
					{% else %}
						<!-- Show valid field -->
						{{ form.num_bath(class="form-control form-control-lg") }}
					{% endif %}
				</div>

				<!-- 7. Submit Button -->
				<div class="form-group">
					{{ form.submit(class="btn btn-info mt-4") }}
				</div>
			</div>	
			
        
        
    </form>
</div>
<!-- END FILTER -->


<p style="font-style: italic;"> <span style="color: #D904C4; font-weight: bold;">{{properties|length}}</span> homes found!</p>
	
{% for property in properties %}
<!-- Display on Page -->
<div class="container-fluid bg-3 text-center"> 
	<div class="row" style="border:1px black solid">
		<!-- Picture on left -->
		<div class="col-sm-3"> 
			<!-- MODIFY ID TO MATCH IMAGE'S DATA-TARGET FIELD ** -->
			<a class="article-title" href="{{ url_for('post', property_id=property.id)}}">
				<img src="data:image/png;base64,{{property.image}}" width="100%">
			</a>
		</div>
		<!-- Details in middle -->
		<div class="col-sm"> 
			<p id="home_type">For {{ property.for_type }}</p>
			<p id="gen_property_type">{{ property.gen_property_type }}</p>
			<p id="home_price">${{ property.price }}</p>
			<p id="home_threes">{{ property.num_bed }} bed &#183; {{ property.num_bath }} bath &#183; {{ property.building_size }} sqft</p>
			<p id="home_address">{{ property.street }}, {{ property.city }} {{ property.state }} {{ property.zip }}</p>
			<p id="home_realtycompany"> {{ property.agent.realty_company }} </p>
		</div>
	</div>
</div>





{% endfor %}



{% endblock content %}